<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idle Noughts</title>


    
    <link rel="stylesheet" href="index.css">

    <script src="common.js"></script>
    
</head>
<body>
    <script>        alert("WIP")
    </script>
    <script src="lookUp3b3.js"></script>
    <script src="lookUp1d.js"></script>

    <script>
        var Board = {

            emptySlots(board) {
                var e = []
                for (i=0; i < 9; i++) {
                    if (board[i][0] != "X" && board[i][0] != "O") {
                        e.push(i)
                    }
                }
                return e
            },

drawBoard(board) {
    for (let x = 0; x < HEIGHT; x++) {
        let drawX = ""
        for (let y = 0; y < WIDTH; y++) {
        
            let draw = board[(x*WIDTH)+y]
            if (draw == "") draw = " "
            drawX = drawX + draw
        }
        console.log("|"+drawX+"|"+"         "+(x+1))
        
    }
    console.log(" ‾‾‾ ")
},


randomizeBoard:function(board) {
    for (let i = 0; i < board.length; i++) {
        let result = randInt(-1, 1)
        if (result == 1) {
            board[i] = "X"
        }
        else if (result == -1) {
            board[i] = "O"
        } else {
            board[i] = ""
        }
    }
    return board
},

compressBoard:function(board) {
    let fenBoard = "",
        lastPiece = "",
        checkLastUpdate = false
    for (let i=0;i<board.length;i++) {
        let piece = board[i]
        if (piece == "") piece = "_"
        checkLastUpdate = false
        if (lastPiece[0] == piece) {
            lastPiece = `${lastPiece[0]}${parseInt(lastPiece[1])+1}`
        } else {
            fenBoard = fenBoard + lastPiece + "/"
            lastPiece = `${piece}1`
            checkLastUpdate = true
        }
        
    }
    fenBoard = fenBoard + lastPiece + "/"
    
    
    return fenBoard
},

decompressBoard:function(board) {
    let splitArray = board.split("/"),
        returnArray = new Array()
    for (let i = 1; i < splitArray.length-1; i++) {
        const split = splitArray[i];
        for (let i = 0; i < parseInt(split[1]); i++) {
            let push = split[0]
            if (split[0] == "_") push = ""
            returnArray.push(push)
        }
    }
    return returnArray
},

flipBoard:function(board) {
    var temBoard = [...board]
    for (let i = 0; i < temBoard.length; i++) {
        if (temBoard[i] == "X") temBoard[i] = "A"
        
    }
    for (let i = 0; i < temBoard.length; i++) {
        if (temBoard[i] == "O") temBoard[i] = "X"
        if (temBoard[i] == "A") temBoard[i] = "O"
        
    }

    return temBoard
},

upsetMove(move) {
    
    return move
}
}
    </script>
    <script>

        var intervals = {}

        var currency = {
            "tics":10,
            "tacs":0,
            "toes":0,
            "tempToes":0,
        }

        function makePurchase(cost) {
            var num = parseInt(cost.split(" ")[0]),
                curr = cost.split(" ")[1]

            if (currency[curr] >= num) {
                currency[curr] -= num
                return true
            }


                

            return false
        }

        var startEncomny = {
            costs:{
                "boards":{
                    "basic": "17.8 tics",
                    "gold-basic": "1000 tics",
                    "1d": "1500 tics",

                },
                "ais":{
                    "jai": "15 tics",
                    "baby": "20 tics",
                    "mid": "30 tics",
                    "adult": "90 tics",
                    "genius": "200 tics",

                    "tactotic-c": "100 tics",
                    "tac&tictotoe-c":"2500 tics",
                }
                
            },
            startingStats:{
                "boards":{
                    "basic":{
                        "skill":0.85,
                        "speed":300,
                        "disadvantage":0,
                    },
                    "gold-basic":{
                        "skill":0.2,
                        "speed":5000,
                        "disadvantage":0.6,
                    },
                    "1d":{
                        "skill":0.2,
                        "speed":550,
                        "disadvantage":0,
                    }
                },
                "ais":{
                    "jai":{
                        skill:1,
                        speed:1000,
                    },
                    "baby":{
                        skill:1.25,
                        speed:1000,
                    },
                    "mid":{
                        skill:1.6,
                        speed:1000,
                    },
                    "adult":{
                        skill:1.8,
                        speed:1000,
                    },
                    "genius":{
                        skill:2,
                        speed:1000,
                    },

                    "tactotic-c":{
                        skill:null,
                        speed:2000,
                    },
                    "tac&tictotoe-c":{
                        skill:null,
                        speed:8500,
                    },
                }
            },
            production:{
                ais:{
                    "tactotic-c":{
                        input:["1 tacs"],
                        output:["1 tics"]
                    },
                    "tac&tictotoe-c":{
                        input:["50 tics", "50 tics"],
                        output:["1 tempToes"]
                    }
                },
                boards:{
                    "basic":[
                        "1 tacs",
                        "1 tacs",
                        "1 tics",
                    ],
                    "gold-basic":[
                        "1 tacs",
                        "1 tacs",
                        "1 tempToes",
                    ],
                    "1d":[
                        "0 tacs",
                        "1 tacs",
                        "2 tics",
                    ],
                },
            }
        },
            encomny = JSON.parse(JSON.stringify(startEncomny))
        
        function multiplyCost(cost, float) {
            var num = cost.split(" ")[0],
                curr = cost.split(" ")[1]

            return `${Math.round(num*float)} ${curr}`
        }
        var ais = new Array()

        function listAi(ele, id, type) {
            var newAi = new (function(ele, id){

                    this.ele = ele
                    this.type = type
                    this.id = id
                    this.stats = {
                        speed:encomny["startingStats"]["ais"][id].speed,
                        missRates:{
                            "basic":0.9,
                        },
                        globalSkill:1,
                        learningRate:encomny["startingStats"]["ais"][id].skill
                    }

                    this.cooldown = 1

                    this.costs = {
                        speed:"5 tics",
                        skill:"50 tics",
                    }

                    this.attachedBoard = undefined

                    this.train = function(boardType, rate) {
                        this.stats.missRates[boardType] *= 0.99875
                    } 
                    //ai.costs.speed = multiplyCost(ai.costs.speed, 1.6)
                    //ai.costs.skill = multiplyCost(ai.costs.skill, 1.8)


                    return this
                })(ele, id)
            ais.push(newAi)

            ele.aiObject = newAi
            return newAi
        }
        
        function updateConverterAis() {
            for (let i = 0; i < ais.length; i++) {
                const ai = ais[i];
                if (ai.type == "converter") {
                    ai.cooldown -= 1/ai.stats.speed
                    ai.ele.children[3].style.width = `${(1-Math.max(ai.cooldown, 0))*85}px`

                    if (ai.cooldown <= 0) {
                        var production = encomny.production.ais[ai.id],
                            canConvert = true

                        for (let i = 0; i < production.input.length; i++) {
                            const int = production.input[i];
                            var num = parseInt(int.split(" ")[0]),
                                curr = int.split(" ")[1]

                            if (currency[curr] < num) {
                                canConvert = false
                                break
                            }
                                
                        }

                        if (canConvert) {
                            for (let i = 0; i < production.input.length; i++) {
                                const int = production.input[i];
                                var num = parseInt(int.split(" ")[0]),
                                    curr = int.split(" ")[1]

                                currency[curr] -= num
                                
                            }
                            for (let i = 0; i < production.output.length; i++) {
                                const int = production.output[i];
                                var num = parseInt(int.split(" ")[0]),
                                    curr = int.split(" ")[1]

                                currency[curr] += num
                                
                            }

                            ai.cooldown = 1
                        }


                    }
                }
            }
        }
    </script>

    <div class="header">
        
        <div class="headerContent">
            <h1>Idle Noughts</h1>
            <h2>B.reef</h2>
            <p><a href="https://github.com/aeolus-1/idlenoughts">->github here<-</a></p>
        </div>
        
        
        <div id="currencyDiv" class="headerContent">
            <p>Tics: 0</p>
            <p>Tacs: 0</p>
            <p style="display: inline-block;">Toes: 0 </p>
            <b>
                 + 0 Toes 
                 <button id="presigeButton">New Game Plus</button><br><br>
                 <button id="toeShopButton" style="width:100%; height: 25px;">Toe Shop</button>
            </b>
        </div>
        <div style="margin-top: -10px;" id="botUpgradeDiv">
            <div id="botUpgradeSlot" class="aiHolder" style="width: 130px; height: 130px; float: left; margin-top: -15px;" ondrop="drop(event)" ondragover="allowDrop(event)">
            </div>
            <h2>Upgrade Ais</h2>
            <button id="upgradeDivSpeedUp">Upgrade Speed<br></button>
            <button id="upgradeDivSkillUp">Upgrade Skill</button>
        </div>
        <div id="botRecycleDiv" style="position: fixed; right: 10px; top: 10px;" >
            <div id="botRecycleSlot" class="aiHolder" style="width: 130px; height: 130px; margin-top: 0px;" ondrop="drop(event)" ondragover="allowDrop(event)">
            </div>
            <button id="recycleButton" style="height: 130px;">Recycle</button>
        </div>
            
    </div>
    <div id="toeShop" class="overlayScreen">
        <button id="toeShopClose">
            Close
        </button>
        wip
    </div>
    <script>
        document.getElementById("toeShop").style.display = "none"
        document.getElementById("toeShopButton").onclick = function(){
            console.log(document.getElementById("toeShop").style.display)
            document.getElementById("toeShop").style.display = ""
        }
        document.getElementById("toeShopClose").onclick = function(){
            console.log(document.getElementById("toeShop").style.display)
            document.getElementById("toeShop").style.display = "none"
        }
        
    </script>
    <script>



    document.getElementById("presigeButton").onclick = function() {
        if (confirm(`Are sure you want to restart?\nYou will get ${currency.tempToes} toes`)) restartGame();
    }


        function restartGame() {
            currency.toes += currency.tempToes
            currency = {
                "tics":10,
                "tacs":0,
                "toes":currency["toes"],
                "tempToes":0,
            }

            ais = new Array()

            
            var boardBin = document.getElementById("boardBin"),
                len = boardBin.children.length
            for (let i = 0; i < len; i++) {
                const ai = boardBin.children[len-i-1];
                console.log(ai)
                
                ai.remove()
            }

            for (let i = 0; i < Object.keys(intervals).length; i++) {
                clearTimeout(intervals[Object.keys(intervals)[i]])
            }

            var aiHolders = document.getElementsByClassName("aiHolder")
            for (let i = 0; i < aiHolders.length; i++) {
                const holder = aiHolders[i];
                
                var len = holder.children.length
                for (let i = 0; i < len; i++) {
                    const ai = holder.children[len-i-1];
                    console.log(ai)
                    
                    ai.remove()
                }
            }

            achievementProgress = 50
            encomny = JSON.parse(JSON.stringify(startEncomny))


            buyBoard("basic", true)

            
        }

        function registerGame(production, num) {
            var gain = production[num+1],
                num = parseInt(gain.split(" ")[0]),
                type = gain.split(" ")[1]

            currency[type] += num
        }

        function updateGameCurrencyDisplay() {
            var div = document.getElementById("currencyDiv")
            div.children[0].textContent = `Tics: ${currency["tics"]}`
            div.children[1].textContent = `Tacs: ${currency["tacs"]}`
            div.children[2].textContent = `Toes: ${currency["toes"]}`           
            div.children[3].childNodes[0].textContent = ` + ${currency["tempToes"]} Toes `

            document.getElementsByTagName("title")[0].textContent = `Idle Noughts - ${currency.tics} Tices`

        }
        
        var updateGameCurrencyDisplayLoop = setInterval(() => {
            updateGameCurrencyDisplay()
        }, (1000/60));


        function updateAisDisplay() {
            
            for (let i = 0; i < ais.length; i++) {
                const ai = ais[i];
                if (ai.type != "board") continue
                var aiSelects = ai.ele.children[2].children[3]
                for (let i = 0; i < aiSelects.children.length; i++) {
                    const child = aiSelects.children[i];
                    var boardType = child.textContent.split(":")[0]
                    child.textContent = `${boardType}: ${round((1-ai.stats.missRates[boardType.toLowerCase()])*ai.stats.globalSkill, 3)}`
                } 

                var speedDisplay = ai.ele.children[2]

                speedDisplay.children[0].textContent = `Speed: ${round(1000/ai.stats.speed, 1)}ps`


            }
        }

        var updateAisDisplayLoop = setInterval(() => {
            updateAisDisplay()
        }, (1000/30));

        function updateBoardsDisplay() {
            var boards = document.getElementById("boardBin").children
            for (let i = 0; i < boards.length; i++) {
                const board = boards[i];
                board.children[2].children[0].textContent = `Speed: ${round(1000/board.stats.speed, 0)}`
                board.children[2].children[3].textContent = `Skill: ${round(1-board.stats.missRate, 2)}`


            }
        }

        var updateBoardsDisplayLoop = setInterval(() => {
            updateBoardsDisplay()
        }, (1000/30));
        

    </script>

    <script>
        
        function createElementFromHTML(htmlString) {
            var div = document.createElement('div');
            div.innerHTML = htmlString.trim();

            // Change this to div.childNodes to support multiple top-level nodes.
            return div.firstChild;
        }

        function mouseClickGameTile(ev, num) {

            var board = ev.parentElement.parentElement 
            if (
                board.turn == "X" && 
                ((ev.textContent[0] == "X" || ev.textContent[0] == "O") ? ev.textContent[0] : "") == "" && 
                board.children[1].children.length < 1 &&
                board.type != "gold-basic"
                ) {

                var sucsess = board.makeMove(board.children[0], num, "X", true)
                board.turn = "O"
                if (!sucsess) {

                    intervals["mouseClick"] = setTimeout(()=>{
                        board.makeAiMove(board, "O")
                    }, board.stats.speed)
                }
            }

            
        }
        
        function boardDivToArray(board) {
            var returnArray = new Array()
            for (let i = 0; i < board.children.length; i++) {
                const tile = board.children[i];
                returnArray.push((tile.textContent[0] == "X" || tile.textContent[0] == "O") ? tile.textContent[0] : "")

            }

            return returnArray
        }
       
        function testBoard(production, board) {
            var gameTiles = boardDivToArray(board.children[0]),
                winner = undefined;
                
                (["X", "O"]).forEach(turn => {
                    var winMoves = {
                        "basic":[
                            [0, 1, 2],
                            [3, 4, 5],
                            [6, 7, 8],
                            [0, 3, 6],
                            [1, 4, 7],
                            [2, 5, 8],
                            [0, 4, 8],
                            [2, 4, 6],
                        ],
                        "gold-basic":[
                            [0, 1, 2],
                            [3, 4, 5],
                            [6, 7, 8],
                            [0, 3, 6],
                            [1, 4, 7],
                            [2, 5, 8],
                            [0, 4, 8],
                            [2, 4, 6],
                        ],
                        "1d":[
                            [0, 1, 2],
                            [1, 2, 3],
                            [2, 3, 4],
                            [3, 4, 5],
                            [4, 5, 6],
                            [5, 6, 7],
                            [6, 7, 8],
                            [7, 8, 9],
                        ]
                    }[board.type]
                    for (let i = 0; i < winMoves.length; i++) {
                        const win = winMoves[i];
                        var correctTiles = 0
                        for (let j = 0; j < win.length; j++) {
                            const winNum = win[j];
                            if (gameTiles[winNum] == turn) {
                                correctTiles += 1
                            }
                        }
                        if (correctTiles >= 3) {
                            winner = turn
                            break

                        }
                    }
                });
            if (winner != undefined) {
                board.turn = " "
                registerGame(production, (winner=="X")?1:-1)
                intervals["resetGameTie"] = setTimeout(() => {
                    board.parentElement.reset(board)
                }, board.stats.speed);
            }
            
            return winner 
            
        }
       
        function aiBoardLoop(board, ai) {
            
            if (board.turn == "X") {
                if (ai.stats.missRates[board.type] == undefined) {
                    ai.stats.missRates[board.type] = 0.9

                }

                ai.train(board.type, ai.stats.learningRate/1000)
            } 

            var aiSkill = 1-((1-(ai.stats.missRates[board.type]*ai.stats.globalSkill))*(1-board.disadvantage))
            board.makeAiMove(board, board.turn, (board.turn=="X")?0:1)
            intervals["aiBoardLoop"] = setTimeout(() => {
                    if (board.children[1].children.length >= 1) {

                        aiBoardLoop(board, ai)
                    }
                }, (board.turn == "X")?ai.stats.speed:board.stats.speed);
            
        }

        function buyBoard(id, cost=false, details={}) {
            console.log(id)
            details = {
                costs:{
                    speed:"5 tics",
                    skill:"10 tics",
                },
                stats:{
                    speed:encomny.startingStats.boards[id].speed,
                    missRate:encomny.startingStats.boards[id].skill,
                },
                id:`${Math.random()}`,
                slotId:`${Math.random()}`,
                ...details,
            }

            if (cost || makePurchase(encomny.costs.boards[id])) {
                encomny.costs.boards[id] = multiplyCost(encomny.costs.boards[id], 1.4)
                var board = createElementFromHTML(document.getElementById(`presetBoard-${id}`).innerHTML),
                    bin = document.getElementById("boardBin")

                board.children[1].id = details.slotId
                
                board.classList.add(`type-${id}`)
                var idid = details.id
                board.id = idid

                board.__proto__.makeMove = function(board, pos, team)  {
                    var gameBoard = board,
                        posNum = pos-1,
                        gameTile = gameBoard.children[posNum]
                    gameTile.textContent = team

                    var production = encomny.production.boards[board.parentElement.type]



                    return testBoard(production, gameBoard.parentElement)


                }
                board.__proto__.makeAiMove = function(board, team, missRate=0.9)  {
                    console.log(board.turn, missRate)
                    var gameBoard = board.children[0]

                    var production = encomny.production.boards[board.type]

                    
                    var boardArray = boardDivToArray(gameBoard),
                        compressedBoard = Board.compressBoard(boardArray),
                        correctMove = lookup1d[compressedBoard]
                        
                    if (correctMove == null) {
                        board.turn = " "
                        registerGame(production, 0)
                        intervals["aiMoveTie"] = setTimeout(() => {
                            board.parentElement.reset(board)
                        }, board.stats.speed);
                    } else {
                        var correctNum = (correctMove.y*3)+correctMove.x,
                            missHit = Math.random()
                        if (missRate > missHit) {
                            var emptyTiles = Board.emptySlots(boardArray),
                                randTile = emptyTiles[randInt(0, emptyTiles.length-1)]
                            correctNum = randTile
                            
                            
                        }

                        

                        var posNum = correctNum,
                            gameTile = gameBoard.children[posNum]

                        gameTile.textContent = team
                        
                        gameBoard.parentElement.turn = (team=="X")?"O":"X"
                        
                    }

                    testBoard(production, gameBoard.parentElement)
                    
                }
                board.__proto__.reset = function(board) {
                    var tiles = board.children[0].children
                    for (let i = 0; i < tiles.length; i++) {
                        const tile = tiles[i];
                        tile.textContent = ""
                    }
                    board.turn = "X"
                    
                }

                
                board.stats = details.stats
                board.costs = details.costs

                console.log(id)
                board.type = id

                board.children[2].children[1].addEventListener("click", ()=>{
                    var board = document.getElementById(idid)
                    if (makePurchase(board.costs.speed)) {
                        board.stats.speed = 1000/((1000/board.stats.speed)*1.05)
                        board.costs.speed = multiplyCost(board.costs.speed, 1.3)
                        board.children[2].children[1].innerHTML = `Upgrade Speed +5%<br>${board.costs.speed}`
                    }
                })
                board.children[2].children[4].addEventListener("click", ()=>{
                    var board = document.getElementById(idid)
                    if (makePurchase(board.costs.skill)) {
                        board.stats.missRate = (board.stats.missRate)*0.9523809524
                        board.costs.skill = multiplyCost(board.costs.skill, 1.3)

                        board.children[2].children[4].innerHTML = `Downgrade Skill -5%<br>${board.costs.skill}`
                    }
                })
                board.disadvantage = encomny.startingStats.boards[id]["disadvantage"]
            

                board.turn = "X"

                bin.appendChild(board)
            }
        }
       
        function buyAI(id, type) {
            if (makePurchase(encomny.costs.ais[id])) {
                encomny.costs.ais[id] = multiplyCost(encomny.costs.ais[id], 1.4)
                var board = createElementFromHTML(document.getElementById(`preset-${type}Ai`).innerHTML),
                    bin = document.getElementById("botBinDiv")

                    board.id = `${Math.random()}`
                    
                    board.classList.add(`typeAi-${id}`)


                    board.getElementsByTagName("i")[0].textContent = `- ${id}`
                listAi(board, id, type)
                bin.appendChild(board)
            }
        }
    </script>

    <div style="margin-top: 200px;">
        <div class="sideBar" >
            <div class="buySideBar">
                <div style="background:  rgba(218, 218, 218); margin: 3px;">
                    <button class="collapsible">Board Ais ⬆︎</button>

                    <div class="collapsibleContent">
                        <div class="buyBlock">
                            <button style="float: right; width: 60px; height: 100%;" onclick="buyAI('jai', 'board')">BUY MONEY $$$</button>

                            jai AI<br>

                            <p id="jai-AiBuyDisplay">
                                Learning Rate:[skillNum]<br>
                                Speed:[speedNum]
                            </p>

                        </div>
                        <div class="buyBlock">
                            <button style="float: right; width: 60px; height: 100%;" onclick="buyAI('baby', 'board')">BUY MONEY $$$</button>

                            Baby AI<br>

                            <p id="baby-AiBuyDisplay">
                                Learning Rate:[skillNum]<br>
                                Speed:[speedNum]
                            </p>

                        </div>
                        <div class="buyBlock">
                            <button style="float: right; width: 60px; height: 100%;" onclick="buyAI('mid', 'board')">BUY MONEY $$$</button>

                            Mid AI<br>

                            <p id="mid-AiBuyDisplay">
                                Learning Rate:[skillNum]<br>
                                Speed:[speedNum]
                            </p>

                        </div>
                        <div class="buyBlock">
                            <button style="float: right; width: 60px; height: 100%;" onclick="buyAI('adult', 'board')">BUY MONEY $$$</button>

                            Adult AI<br>

                            <p id="adult-AiBuyDisplay">
                                Learning Rate:[skillNum]<br>
                                Speed:[speedNum]
                            </p>

                        </div>
                        <div class="buyBlock">
                            <button style="float: right; width: 60px; height: 100%;" onclick="buyAI('genius', 'board')">BUY MONEY $$$</button>

                            Genius AI<br>

                            <p id="genius-AiBuyDisplay">
                                Learning Rate:[skillNum]<br>
                                Speed:[speedNum]
                            </p>

                        </div>
                    </div>
                </div>
                <div style="background:  rgba(218, 218, 218); margin: 3px;">
                    <button class="collapsible">Converter Ais ⬆︎</button>

                    <div class="collapsibleContent">
                        <div class="buyBlock">
                            <button style="float: right; width: 60px; height: 100%;" onclick="buyAI('tactotic-c', 'converter')">BUY MONEY $$$</button>

                            Tac to Tic AI<br>

                            <p id="tactotic-c-AiBuyDisplay">
                                Speed:[speedNum]
                            </p>

                        </div>
                        <div class="buyBlock">
                            <button style="float: right; width: 60px; height: 100%;" onclick="buyAI('tactotic-c', 'converter')">BUY MONEY $$$</button>

                            Tic to Toe AI<br>

                            <p id="tac&tictotoe-c-AiBuyDisplay">
                                Speed:[speedNum]
                            </p>

                        </div>
                        
                    </div>
                </div>
                
            </div>
            <div class="buySideBar">
                <div >
                    <div class="buyBlock" style="height: 150px;" id="basic-BoardBuyDisplay">
                        <button style="float: right; width: 60px; height: 100%;" onclick="buyBoard('basic')">BUY MONEY $$$</button>
    
                        <b>Basic Board</b><br>
                        <img src="imgs/basicBoard.png" alt="ur gay" width="20%">
                        <p>
                            Speed: 1000
                            <br>
                            Difficulty: 0.25
                            <br>
                            Disadvantage: 0
                        </p>
    
                    </div>
                    <div class="buyBlock" style="height: 150px;" id="gold-basic-BoardBuyDisplay">
                        <button style="float: right; width: 60px; height: 100%;" onclick="buyBoard('gold-basic')">BUY MONEY $$$</button>
    
                        <b>Gold Basic Board</b><br>
                        <img src="imgs/goldBoard.png" alt="ur gay" width="20%">
    
                        <p>
                            Speed: 5000
                            <br>
                            Difficulty: 0.75
                            <br>
                            Disadvantage: 0.5
                        </p>
    
                    </div>
                    <div class="buyBlock" style="height: 150px;" id="1d-BoardBuyDisplay">
                        <button style="float: right; width: 60px; height: 100%;" onclick="buyBoard('1d')">BUY MONEY $$$</button>
    
                        <b>1D Board</b><br>
                        <img src="imgs/1dBoard.png" alt="ur gay" width="40%">
    
                        <p>
                            Speed: 5000
                            <br>
                            Difficulty: 0.75
                            <br>
                            Disadvantage: 0.5
                        </p>
    
                    </div>
                    
                </div>
                
                
            </div>
        </div>


        <hr>


        <script>
            document.getElementById("upgradeDivSpeedUp").onclick = function(){
                var div = this.parentElement,
                    ai = div.children[0].children
                if (ai.length > 0) {
                    ai = ai[0].aiObject

                    if (makePurchase(ai.costs.speed)) {

                        ai.stats.speed = Math.round(ai.stats.speed*0.9756097561)
                        ai.costs.speed = multiplyCost(ai.costs.speed, 1.6)

                        div.children[2].innerHTML = `Upgrade Speed +5%<br>${ai.costs.speed}`
                        div.children[3].innerHTML = `Upgrade Skill +5%<br>${ai.costs.skill}`
                    }
                    
                }

            }
            document.getElementById("upgradeDivSkillUp").onclick = function(){
                var div = this.parentElement,
                    ai = div.children[0].children
                if (ai.length > 0) {
                    ai = ai[0].aiObject
                    if (makePurchase(ai.costs.skill)) {

                    
                        ai.stats.globalSkill = (ai.stats.globalSkill)*1.025
                        ai.costs.skill = multiplyCost(ai.costs.skill, 1.8)

                        div.children[2].innerHTML = `Upgrade Speed +5%<br>${ai.costs.speed}`
                        div.children[3].innerHTML = `Upgrade Skill +5%<br>${ai.costs.skill}`
                    }
                    
                }
            }

            function setUpgradeDiv() {
                var upgradeDiv = document.getElementById("botUpgradeDiv"),
                    ai = upgradeDiv.children[0].children

                if (ai.length > 0) {
                    ai = ai[0].aiObject

                    upgradeDiv.children[2].innerHTML = `Upgrade Speed +5%<br>${ai.costs.speed}`
                    upgradeDiv.children[3].innerHTML = `Upgrade Skill +5%<br>${ai.costs.skill}`
                } else {

                }
                    


            }
            function getValue(ai) {
                var value = 5
                
                var keys = Object.keys(ai.stats.missRates)
                for (let i = 0; i < keys.length; i++) {
                    var key = keys[i],
                        rate = ai.stats.missRates[key]

                    value += Math.floor((1-rate)*20*ai.stats.globalSkill)
                    
                }
                value += Math.floor((1000/ai.stats.speed)*50)
                return Math.round(value*0.5)
            }

            function setRecycleDiv() {
                var recycleDiv = document.getElementById("botRecycleDiv"),
                    ai = recycleDiv.children[0].children

                if (ai.length > 0) {
                    ai = ai[0].aiObject


                    recycleDiv.children[1].innerHTML = `Recycle<br>${getValue(ai)} tacs`
                
                } else {
                    recycleDiv.children[1].innerHTML = `Recycle`
                }
                


            }

            document.getElementById("recycleButton").onclick = function(){
                var div = this.parentElement,
                    ai = div.children[0].children
                if (ai.length > 0) {
                    makePurchase(`-${getValue(ai[0].aiObject)} tacs`)
                    ai[0].remove()
                    
                }
            }

            function allowDrop(ev) {
                if ((ev.target.id == "botBinDiv" || ev.target.id == "botUpgradeSlot" || ev.target.id == "botRecycleSlot") || (ev.target.classList[0] == "botBoardSlot" && ev.target.children.length <= 1)) {
                    ev.preventDefault();
                }
            }
            
            function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
            }
            
            function drop(ev) {
                document.getElementById("upgradeDivSpeedUp").innerHTML = "Upgrade Speed"
                document.getElementById("upgradeDivSkillUp").innerHTML = "Upgrade Skill"
                if (true) {
                    ev.preventDefault();
                    var data = ev.dataTransfer.getData("text"),
                        aiDiv = document.getElementById(data)
                    ev.target.appendChild(aiDiv);
                    
                    aiDiv.aiObject.attachedBoard = ev.target.parentElement
                    aiDiv.aiObject.droppedElement = ev.target
                    var board = ev.target.parentElement
                    if (board.classList[0] == "board") {
                        aiBoardLoop(board, aiDiv.aiObject)
                    }
                    if (board.id == "botUpgradeDiv") {
                    }
                    setTimeout(() => {
                        setUpgradeDiv()
                        setRecycleDiv()
                    }, 20); 

                    


                }
            }
        </script>

        <div class="pageSection">
            
            <div id="preset-boardAi" style="display: none;">
                <div id="${Math.random()}" class="botDraggableEle" draggable="true" ondragstart="drag(event)">
                      [Name]<br>
                      <i>- Type</i>
                      <p><b>Speed: 1</b><br>  
                        <b>Skill:</b>  
                        <select>
                            <option>Basic: 0</option>
                        </select>  
                    </p> 
                </div>

            </div>
            <div id="preset-converterAi" style="display: none;">
                <div id="${Math.random()}" class="botDraggableEle" draggable="true" ondragstart="drag(event)">
                      [Name]<br>
                      <i>- Type</i>
                      <p><b>Speed: 1</b><br>  
                        <div class="converterProgressBar"></div>
                    </p> 
                </div>

            </div>

            
            
            <div id="botBinDiv" class="aiHolder" ondrop="drop(event)" ondragover="allowDrop(event)">
                
                
            </div>
            
        </div>

        <hr>
    
        <div class="pageSection">
            
            <div id="presetBoard-basic" style="display: none;">
                <div class="board type-${id}" id="${Math.random()}">
                    <div class="boardGameArea">                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 1)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 2)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 3)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 4)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 5)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 6)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 7)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 8)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 9)">                                            
                        </div>                
                    </div>                
                    <div class="botBoardSlot aiHolder" ondrop="drop(event)" ondragover="allowDrop(event)">                
                    </div>
                    <div class="boardUpgradeArea">
                        <b>Speed: 1</b>
                        <button>Upgrade Speed +5%<br>5 tics</button>    <hr>

                        <b>Enemy Skill: 1</b>
                        <button>Downgrade Skill -5%<br>10 tics</button>    <br>
                    </div>
            </div>
            </div>

            <div id="presetBoard-gold-basic" style="display: none;">
                <div class="board type-${id}" id="${Math.random()}">
                    <div class="boardGameArea">                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 1)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 2)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 3)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 4)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 5)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 6)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 7)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 8)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 9)">                                            
                        </div>                
                    </div>                
                    <div class="botBoardSlot aiHolder" ondrop="drop(event)" ondragover="allowDrop(event)">                
                    </div>
                    <div class="boardUpgradeArea">
                        <b>Speed: 1</b>
                        <button>Upgrade Speed +5%<br>5 tics</button>    <hr>

                        <b>Enemy Skill: 1</b>
                        <button>Downgrade Skill -5%<br>10 tics</button>    <br>
                    </div>
            </div>
            </div>
            
            <div id="presetBoard-1d" style="display: none;">
                <div class="board type-${id}" id="${Math.random()}">
                    <div class="boardGameArea">                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 1)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 2)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 3)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 4)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 5)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 6)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 7)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 8)">                                            
                        </div>                    
                        <div class="boardGameSquare" onclick="mouseClickGameTile(this, 9)">                                            
                        </div>                
                    </div>                
                    <div class="botBoardSlot" ondrop="drop(event)" ondragover="allowDrop(event)">                
                    </div>
                    <div class="boardUpgradeArea">
                        <b>Speed: 1</b>
                        <button>Upgrade Speed +5%<br>5 tics</button>    <hr>

                        <b>Enemy Skill: 1</b>
                        <button>Downgrade Skill -5%<br>10 tics</button>    <br>
                    </div>
            </div>
            </div>

            <div id="boardBin">
                
            </div>
        </div>
    </div>

    <div class="footer" id="footer">
        
        <h3 style="text-align: center;" for="progressBar"></h3>
        <p style="text-align: center;"></p>
        <progress id="achievementProgressBar" name="progressBar" style="width: 100%; height: 50px;" value="50" max="100"></progress>
    </div>

        <script>

            

            window.onload = ()=>{

                function getConverterValues(array) {
                    var s = ""
                    for (let i = 0; i < array.length; i++) {
                        const arr = array[i];
                        s += `${arr}`
                        if (i< array.length-1) {
                            s+=" + "
                        }
                    }
                    return s
                }

                function setAIBuy(id) {
                    if (id[id.length-2] == "-") {
                        var production = encomny.production.ais[id]
                        document.getElementById(`${id}-AiBuyDisplay`).innerHTML = `Speed:${encomny.startingStats.ais[id].speed}<br><br>${getConverterValues(production.input)}<br>⬇︎<br>${getConverterValues(production.output)}`
                    } else {
                        document.getElementById(`${id}-AiBuyDisplay`).innerHTML = `Learning Rate: ${encomny.startingStats.ais[id].skill}<br>Speed: ${encomny.startingStats.ais[id].speed}`
                    }

                    document.getElementById(`${id}-AiBuyDisplay`).parentElement.children[0].textContent = `${encomny.costs["ais"][id]}`

                    
                };

                

                function setBoardBuy(id) {
                    document.getElementById(`${id}-BoardBuyDisplay`).children[0].textContent = encomny.costs.boards[id]
                    document.getElementById(`${id}-BoardBuyDisplay`).children[4].innerHTML = `Speed: ${round(encomny.startingStats.boards[id].speed, 3)}<br>Difficulty: ${round(1-encomny.startingStats.boards[id].skill, 3)}<br>Disadvantage: ${round(encomny.startingStats.boards[id].disadvantage, 3)}`
                    /*
                    document.getElementById(`${id}-BoardBuyDisplay`).children = document.getElementById(`${id}-BoardBuyDisplay`).textContent.replace("[skillNum]", encomny.startingStats["ais"][id].skill).replace("[speedNum]", encomny.startingStats["ais"][id].speed)
                    
                    document.getElementById(`${id}-BoardBuyDisplay`).parentElement.children[0].textContent = `${encomny.costs["ais"][id]}`
                    
                    
                    */

                    
                };

                setInterval(() => {
                    (["basic", "gold-basic", "1d"]).forEach((age)=>{
                    setBoardBuy(age)
                });
                (["jai", "baby", "mid", "adult", "genius", "tactotic-c", "tac&tictotoe-c"]).forEach((age)=>{
                    setAIBuy(age)
                })
                }, 50);
                
                
                

                
            }

            var achievementProgress = 50
            function updateProgressBar() {
                document.getElementById("achievementProgressBar").value = `${(currency.tics/achievementProgress)*100}`
                if ((currency.tics/achievementProgress) >= 1) {
                    currency.tics += Math.floor(achievementProgress*0.25)
                    achievementProgress *= 5
                }

                var foot = document.getElementById("footer")
                foot.children[0].textContent = `Cash Bonus: ${achievementProgress-currency.tics} tics left`
                foot.children[1].textContent = `${currency.tics}/${achievementProgress}`
                
            }

            setInterval(updateProgressBar, 50)
            var saveVersion = "v6"
            function getGameData() {
                var data = {
                    saveVersion:saveVersion,
                    currency:JSON.parse(JSON.stringify(currency)),
                    encomny:JSON.parse(JSON.stringify(encomny)),
                    boards:[],
                    ais:[],

                    achievementProgress:achievementProgress,
                },
                    boards = document.getElementById("boardBin").children

                for (let i = 0; i < boards.length; i++) {
                    const board = boards[i];
                    data.boards.push({
                        type:board.type,
                        stats:board.stats,
                        costs:board.costs,

                        id:board.id,
                        slotId:board.children[1].id
                        
                    })
                }

                for (let i = 0; i < ais.length; i++) {
                    const ai = ais[i];
                    data.ais.push({
                        id:ai.id,
                        type:ai.type,
                        stats:ai.stats,
                        costs:ai.costs,

                        idid:ai.id,
                        boardId:(ai.attachedBoard!=undefined)?ai.droppedElement.id:"botBinDiv",
                        
                    })
                }

                return data
            }
            function loadGameData(data) {
                var saveDat = JSON.parse(data)
                restartGame()
                currency = {
                    "tics":0,
                    "tacs":0,
                    "toes":0,
                    "tempToes":0,
                }

                achievementProgress = saveDat.achievementProgress

                currency = saveDat.currency
                encomny = saveDat.encomny

                document.getElementById("boardBin").children[0].remove()

                for (let i = 0; i < saveDat.boards.length; i++) {
                    const board = saveDat.boards[i];

                    buyBoard(board.type, true, board)
                }

                for (let i = 0; i < saveDat.ais.length; i++) {
                    const ai = saveDat.ais[i];
                    
                    var board = createElementFromHTML(document.getElementById(`preset-${ai.type}Ai`).innerHTML),
                    bin = document.getElementById(ai.boardId)


                    board.id = ai.idid
                    
                    board.classList.add(`typeAi-${ai.id}`)

                    


                    board.getElementsByTagName("i")[0].textContent = `- ${ai.id}`
                    
                    var newAi = listAi(board, ai.id, ai.type)

                    newAi.stats = ai.stats
                    newAi.costs = ai.costs

                    newAi.attachedBoard = bin
                    newAi.droppedElement = bin


                    console.log(board.attachedBoard, bin)
                    if (bin.parentElement.classList[0] == "board") {
                        aiBoardLoop(bin.parentElement, board.aiObject)
                    }
                    if (bin.parentElement.id == "botUpgradeDiv") {
                        setUpgradeDiv(board)
                    }
                    setRecycleDiv(board)

                    bin.appendChild(board)
                }
                

                
            }
        </script>
        <script>
            var coll = document.getElementsByClassName("collapsible");
            var i;

            for (i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.display === "block") {

                content.style.display = "none";
                } else {

                content.style.display = "block";
                }
            });
        }

        restartGame()
        </script>

        <script>

            function saveGame() {
                var gameData = btoa(JSON.stringify(getGameData()))
                localStorage.setItem("date", gameData)
            }

            localStorage.setItem("mainGameSave-DO_NOT_TOUCH", btoa("ajksl ndkjahbskld huasndiuyagnsyduaksgydbkuasbdygadisugaisuydgbuiaygsdyuiasgdbiuybgasiudbguyiasbdiuagsiuydbgaiuysdiuygasydganoisydbgasyid8obadgicnsoidngliaugd cliygneliygnclifwbvfrgdnskgrefvifwygoxiewyboiyfbweygivfoiydgvwbeiouhdfhouwebfchowe7ivfoiuwegdigbeiouhvfiouywrgeofi7vowgriuyercfgnoiywrgfixnyorgwfibvoweygvfwgcyiowegfvbgwoey"))
            var save = localStorage.getItem("date")

            if (save != null) {
                save = atob(save)
                if (JSON.parse(save).saveVersion == saveVersion) {
                    loadGameData(save)
                } else {
                    alert("Save version outdated\nrestarting progress\nnot soz")
                }
            } else {
                saveGame()
            }

            setInterval(() => {
                saveGame()
            }, 1000);

            
        </script>
</body>
</html>
